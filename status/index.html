<!DOCTYPE html>
<html>
<head>
	<title>Chaucha Status</title>
	<link href='./style.css' rel='stylesheet'>
	<link href="../favicon.ico" rel="icon" type="image/x-icon">
</head>
<body>
<div id="derecha">
<h1>Mining Pool</h1>
<ul>
<li>Hashing power: <b id="hashrate">...</b></li>
<li>Dificultad de la red: <b id="diff">...</b></li>
<li>Proximo bloque en <b id="time">...</b> minutos</li>
</ul>

<h1>Blockchain</h1>
<ul>
<li>Ultimo block: <b id="count">...</b></li>
<li>Timestamp: <b id="timestamp">...</b></li>
<li>Hash: <b id="hash">...</b></li>
<li><b id="link">...</b></li>
</ul>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">
var timer = setInterval(refresh, 5000);
function refresh () {
	$.getJSON("http://pool.chaucha.cl/api/stats", function(json) {
		$.get( "http://explorer.chaucha.cl/api/getdifficulty", function(diff) {
			$('#time').text(Math.round(diff * 100 * 71582788.3 / json['pools']['chaucha']['hashrate'])/100);
			$('#diff').text(Math.round(diff*100)/100);
			$('#workers').text(json['pools']['chaucha']['workerCount']);
			$('#paid').text(Math.round(100 * json['pools']['chaucha']['poolStats']['totalPaid'])/100);
			$('#hashrate').text(json['pools']['chaucha']['hashrateString']);
		});
	});
	
	$.get( "http://explorer.chaucha.cl/api/getblockcount", function(count) {
		$.get("http://explorer.chaucha.cl/api/getblockhash?index=" + count, function(hash) {
			$.getJSON("http://explorer.chaucha.cl/api/getblock?hash=" + hash, function (blockjson) {
				$('#link').html('<a href="http://explorer.chaucha.cl/block/' + hash + '" target="_blank">Ver m√°s en el Block Explorer</a>');
				$('#hash').text(hash);
				$('#count').text(count);
				var fecha = new Date(parseInt(blockjson['time'])*1000);
				$('#timestamp').text(fecha.toLocaleString('es-CL'));
			});
		});
	});	
};
</script>
</body>
</html>